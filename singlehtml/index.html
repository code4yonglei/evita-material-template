

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="./">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>High Performance Data Analytics in Python documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
      <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_lesson.css" />
      <link rel="stylesheet" type="text/css" href="_static/term_role_formatting.css" />
      <link rel="stylesheet" type="text/css" href="_static/sphinx_rtd_theme_ext_color_contrast.css" />
      <link rel="stylesheet" type="text/css" href="_static/overrides.css" />

  
    <link rel="shortcut icon" href="_static/favicon.ico"/>
      <script src="_static/jquery.js?v=5d32c60e"></script>
      <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="_static/documentation_options.js"></script>
      <script src="_static/doctools.js"></script>
      <script src="_static/sphinx_highlight.js"></script>
      <script src="_static/clipboard.min.js"></script>
      <script src="_static/copybutton.js"></script>
      <script src="_static/minipres.js"></script>
      <script>let toggleHintShow = 'Click to show';</script>
      <script>let toggleHintHide = 'Click to hide';</script>
      <script>let toggleOpenOnPrint = 'true';</script>
      <script src="_static/togglebutton.js"></script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
      <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="#" class="icon icon-home">
            High Performance Data Analytics in Python
              <img src="_static/evita.png" class="logo" alt="Logo"/>
          </a>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Software setup</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-Python-HPDA-0-SoftwareSetup">Setting Up Programming Environment</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Lesson episodes</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="#document-Python-HPDA-1-Motivation">1. Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-Python-HPDA-2-EfficientArrayComputing">2. Efficient Array Computing</a></li>
<li class="toctree-l1"><a class="reference internal" href="#document-3-jupyter-notebook-styling">3. Sphinx Directives</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="#">High Performance Data Analytics in Python</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="#" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">High Performance Data Analytics in Python  documentation</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/ENCCS/evita-material-template/blob/main/content/index" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="high-performance-data-analytics-in-python">
<h1>High Performance Data Analytics in Python<a class="headerlink" href="#high-performance-data-analytics-in-python" title="Link to this heading"></a></h1>
<p>Scientists, engineers and professionals from many sectors are seeing an enormous growth in the size and number of datasets relevant to their domains. Professional titles have emerged to describe specialists working with data, such as data scientists and data engineers, but also other experts are finding it necessary to learn tools and techniques to work with big data. Typical tasks include preprocessing, analysing, modeling and visualising data.</p>
<p>Python is an industry-standard programming language for working with data on all levels of the data analytics pipeline. This is in large part because of the rich ecosystem of libraries ranging from generic numerical libraries to special-purpose and/or domain-specific packages, often supported by large developer communities and stable funding sources.</p>
<p>This lesson will give an overview of working with research data in Python using general libraries for storing, processing, analysing and sharing data. The focus is on high performance. After covering tools for performant processing on single workstations the focus shifts to profiling and optimising, parallel and distributed computing.</p>
<div class="admonition-prerequisites prerequisites admonition" id="prerequisites-0">
<p class="admonition-title">Prerequisites</p>
<ul class="simple">
<li><p>Basic experience with Python</p></li>
<li><p>Basic experience in working in a Linux-like terminal</p></li>
<li><p>Some prior experience in working with large or small datasets</p></li>
</ul>
</div>
<section id="reading-materials">
<h2>Reading materials<a class="headerlink" href="#reading-materials" title="Link to this heading"></a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://aaltoscicomp.github.io/python-for-scicomp/">Python for Scientific Computing</a></p></li>
<li><p><a class="reference external" href="https://uppmax.github.io/HPC-python/">Using Python in an HPC Environment</a></p></li>
<li><p><a class="reference external" href="https://enccs.github.io/python-perf/">Python Performance Workshop</a></p></li>
<li><p>…</p></li>
</ul>
<div class="toctree-wrapper compound">
<span id="document-Python-HPDA-0-SoftwareSetup"></span><section id="setting-up-programming-environment">
<h3>Setting Up Programming Environment<a class="headerlink" href="#setting-up-programming-environment" title="Link to this heading"></a></h3>
<p>In order to run hands-on exercises in this course, you need the Python package and several depenencies.</p>
<ul class="simple">
<li><p>If you use your own computer to run exercises, you should follow the instructions described below to install relevant packages and setup specific programming environment before running hands-on exercises.</p></li>
<li><p>You can use an HPC cluster if you have access to one to run hands-on exercises. Below we provide a short description to login to the <a class="reference external" href="https://www.lumi.csc.fi/public/"><strong>LUMI</strong></a> cluster, load the modules, and run interactive/batch jobs.</p></li>
</ul>
<section id="local-installation">
<h4>Local Installation<a class="headerlink" href="#local-installation" title="Link to this heading"></a></h4>
<section id="install-miniforge">
<h5>Install miniforge<a class="headerlink" href="#install-miniforge" title="Link to this heading"></a></h5>
<p>If you already have a preferred way to manage Python versions and libraries, you can stick to that. If not, we recommend that you install Python3 and all libraries using Miniforge, a free minimal installer for the package, dependency and environment manager conda.</p>
<p>Please follow the <a class="reference external" href="https://conda-forge.org/download/">installation instructions</a> to install Miniforge.</p>
<p>Make sure that conda is correctly installed:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conda<span class="w"> </span>--version
<span class="c1"># conda 24.11.2</span>
</pre></div>
</div>
</section>
<section id="install-python-programming-environment-on-personal-computer">
<h5>Install python programming environment on personal computer<a class="headerlink" href="#install-python-programming-environment-on-personal-computer" title="Link to this heading"></a></h5>
<p><strong>For Mac users</strong></p>
<p>With conda installed, install the required dependencies by running:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>--yes<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/ENCCS/hpda-python/main/content/env/environment.yml
</pre></div>
</div>
<p>This will create a new environment pyhpda which you need to activate by:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>conda<span class="w"> </span>activate<span class="w"> </span>pyhpda
</pre></div>
</div>
<p>Ensure that the Python version is fairly recent:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>python<span class="w"> </span>--version
<span class="c1"># Python 3.12.8</span>
</pre></div>
</div>
<p>Finally, open Jupyter-Lab in your browser:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>jupyter-lab
</pre></div>
</div>
<p>If you use VS code, you can come to the installed <code class="docutils literal notranslate"><span class="pre">pyhpda</span></code> programming environment via choosing <code class="docutils literal notranslate"><span class="pre">Select</span> <span class="pre">Kernel</span></code> ar the upper right corner, <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">Environents</span></code> and you will find the pre-installed <code class="docutils literal notranslate"><span class="pre">pyhpda</span></code> programming environment.</p>
<p><strong>For Linux users</strong></p>
<p>Please provide detailes instructures for linux users to install packages.</p>
<p><strong>For Windows users</strong></p>
<p>Please provide detailes instructures for windows users to install packages.</p>
</section>
</section>
<section id="using-hpc-cluster">
<h4>Using HPC Cluster<a class="headerlink" href="#using-hpc-cluster" title="Link to this heading"></a></h4>
<section id="lumi">
<h5>LUMI<a class="headerlink" href="#lumi" title="Link to this heading"></a></h5>
<section id="login-to-lumi-cluster">
<h6>Login to LUMI cluster<a class="headerlink" href="#login-to-lumi-cluster" title="Link to this heading"></a></h6>
<p>Follow practical instructions <a class="reference external" href="https://enccs.se/tutorials/2024/02/log-in-to-lumi-cluster/"><strong>HERE</strong></a> to get your access to LUMI cluster.</p>
<ul class="simple">
<li><p>On Step 5, you can login to LUMI cluster through terminal.</p></li>
<li><p>On Step 6, you can login to LUMI cluster from the web-interface.</p></li>
</ul>
</section>
<section id="running-jobs-on-lumi-cluster">
<h6>Running jobs on LUMI cluster<a class="headerlink" href="#running-jobs-on-lumi-cluster" title="Link to this heading"></a></h6>
<p>If you want to run an interactive job asking for 1 node, 1 GPU, and 1 hour:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>salloc<span class="w"> </span>-A<span class="w"> </span>project_XXXXX<span class="w"> </span>-N<span class="w"> </span><span class="m">1</span><span class="w"> </span>-t<span class="w"> </span><span class="m">1</span>:00:00<span class="w"> </span>-p<span class="w"> </span>standard-g<span class="w"> </span>--gpus-per-node<span class="o">=</span><span class="m">1</span>

$<span class="w"> </span>srun<span class="w"> </span>&lt;some-command&gt;
</pre></div>
</div>
<p>Exit interactive allocation with <code class="docutils literal notranslate"><span class="pre">exit</span></code>.</p>
<p>You can also submit your job with a batch script submit.sh:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash -l</span>
<span class="c1">#SBATCH --account=project_XXXXX</span>
<span class="c1">#SBATCH --job-name=example-job</span>
<span class="c1">#SBATCH --output=examplejob.o%j</span>
<span class="c1">#SBATCH --error=examplejob.e%j</span>
<span class="c1">#SBATCH --partition=standard-g</span>
<span class="c1">#SBATCH --nodes=1</span>
<span class="c1">#SBATCH --gpus-per-node=1</span>
<span class="c1">#SBATCH --ntasks-per-node=1</span>
<span class="c1">#SBATCH --time=1:00:00</span>

srun<span class="w"> </span>&lt;some_command&gt;
</pre></div>
</div>
<p>Some useful commands are listed below:</p>
<ul class="simple">
<li><p>Submit the job: <code class="docutils literal notranslate"><span class="pre">sbatch</span> <span class="pre">submit.sh</span></code></p></li>
<li><p>Monitor your job: <code class="docutils literal notranslate"><span class="pre">squeue</span> <span class="pre">--me</span></code></p></li>
<li><p>Kill job: <code class="docutils literal notranslate"><span class="pre">scancel</span> <span class="pre">&lt;JOB_ID&gt;</span></code></p></li>
</ul>
</section>
<section id="using-pyhpda-programming-environment-on-lumi-cluster">
<h6>Using <code class="docutils literal notranslate"><span class="pre">pyhpda</span></code> programming environment on LUMI cluster<a class="headerlink" href="#using-pyhpda-programming-environment-on-lumi-cluster" title="Link to this heading"></a></h6>
<p>We have installed the <code class="docutils literal notranslate"><span class="pre">pyhpda</span></code> programming environment on LUMI. You can follow instructions below to activate it and login to LUMI cluster, either via terminal or through the web-interface.</p>
<p><strong>Login to LUMI cluster via terminal</strong> and then the commands below to check and activate the pyhpda environment.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>/projappl/projecXXXXX10/miniconda3/bin/conda<span class="w"> </span>init

$<span class="w"> </span><span class="nb">source</span><span class="w"> </span>~/.bashrc

$<span class="w"> </span>which
<span class="c1"># you should get output as shown below</span>
/project/project_XXXXX/miniconda3/condabin/cond

$<span class="w"> </span>conda<span class="w"> </span>activate<span class="w"> </span>pyhpda

$<span class="w"> </span>which<span class="w"> </span>python
<span class="c1"># you should get output as shown below</span>
/project/project_XXXXX/miniconda3/envs/pyhpda/bin/python
<span class="w"> </span>conda
</pre></div>
</div>
<p><strong>Login to LUMI cluster via <a class="reference internal" href="#"><span class="xref myst">web-interface</span></a></strong> and then select <code class="docutils literal notranslate"><span class="pre">Jupyter</span></code> (not <code class="docutils literal notranslate"><span class="pre">Jupyter</span> <span class="pre">for</span> <span class="pre">courses</span></code>) icon for an interactive session, and provide the following values in the form to launch the jupyter lab app.</p>
<ul class="simple">
<li><p>Project: <code class="docutils literal notranslate"><span class="pre">project_XXXXX</span></code></p></li>
<li><p>Partition: <code class="docutils literal notranslate"><span class="pre">interactive</span></code></p></li>
<li><p>Number of CPU cores: <code class="docutils literal notranslate"><span class="pre">2</span></code></p></li>
<li><p>Time: <code class="docutils literal notranslate"><span class="pre">4:00:00</span></code></p></li>
<li><p>Working directory: <code class="docutils literal notranslate"><span class="pre">/projappl/project_XXXXX</span></code></p></li>
<li><p>Python: <code class="docutils literal notranslate"><span class="pre">Custom</span></code></p></li>
<li><p>Path to python: <code class="docutils literal notranslate"><span class="pre">/project/project_XXXXX/miniconda3/envs/pyhpda/bin/python</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check</span></code> for <em>Enable system installed packages on venv creation</em></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">check</span></code> for Enable packages under <em>~/.local/lib on venv start</em></p></li>
<li><p>Click the <code class="docutils literal notranslate"><span class="pre">Launch</span></code> button, wait for minutes until your requested session was created.</p></li>
<li><p>Click the <code class="docutils literal notranslate"><span class="pre">Connect</span> <span class="pre">to</span> <span class="pre">Jupyter</span></code> button, and then select the Python kernel <code class="docutils literal notranslate"><span class="pre">Python</span> <span class="pre">3</span> <span class="pre">(venv)</span></code> for the created Jupyter notebooks.</p></li>
</ul>
</section>
</section>
<section id="leonardo-booster">
<h5>Leonardo Booster<a class="headerlink" href="#leonardo-booster" title="Link to this heading"></a></h5>
<section id="login-to-leonardo-booster-cluster">
<h6>Login to Leonardo Booster cluster<a class="headerlink" href="#login-to-leonardo-booster-cluster" title="Link to this heading"></a></h6>
<p>Follow instructions at <a class="reference external" href="https://enccs.se/news/2023/09/how-to-login-to-leonardo-supercomputer/">HERE</a> to get your access to Leonardo Booster cluster.</p>
</section>
<section id="running-jobs-on-leonardo-booster-cluster">
<h6>Running jobs on Leonardo Booster cluster<a class="headerlink" href="#running-jobs-on-leonardo-booster-cluster" title="Link to this heading"></a></h6>
<p>Here are instructions to run jobs on Leonardo Booster cluster</p>
<ul class="simple">
<li><p>xxx</p></li>
<li><p>xxx</p></li>
</ul>
</section>
<section id="using-pyhpda-programming-environment-on-leonardo-booster-cluster">
<h6>Using <code class="docutils literal notranslate"><span class="pre">pyhpda</span></code> programming environment on Leonardo Booster cluster<a class="headerlink" href="#using-pyhpda-programming-environment-on-leonardo-booster-cluster" title="Link to this heading"></a></h6>
<p>Here are instructions to install the <code class="docutils literal notranslate"><span class="pre">pyhpda</span></code> programming environment on Leonardo Booster cluster</p>
<ul class="simple">
<li><p>xxx</p></li>
<li><p>xxx</p></li>
</ul>
</section>
</section>
</section>
</section>
</div>
<div class="toctree-wrapper compound">
<span id="document-Python-HPDA-1-Motivation"></span><section id="motivation">
<h3>1. Motivation<a class="headerlink" href="#motivation" title="Link to this heading"></a></h3>
<p>This episode provides a broad overview of this course and the main motivation to attend this course.</p>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>What is big data</p></li>
<li><p>What is the Python programming environment and the ecosystem</p></li>
<li><p>What you will learn during this course</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>20 min teaching/type-along</p></li>
<li><p>0 min exercising</p></li>
</ul>
</div>
<section id="big-data">
<h4>1.1 Big Data<a class="headerlink" href="#big-data" title="Link to this heading"></a></h4>
<div class="{discussion}: docutils">
<ul class="simple">
<li><p>How large is the data you are working with?</p></li>
<li><p>Are you experiencing performance bottlenecks when you try to analyse it?</p></li>
</ul>
</div>
<p>“Big data refers to data sets that are too large or complex to be dealt with by traditional data-processing application software. […] Big data analysis challenges include capturing data, data storage, data analysis, search, sharing, transfer, visualization, querying, updating, information privacy, and data source.” (from <a class="reference external" href="https://en.wikipedia.org/wiki/Big_data">Wikipedia</a>)</p>
<p>“Big data” is a current buzzword used heavily in the tech industry, but many scientific research communities are increasingly adopting high-throughput data production methods which lead to very large datasets. One driving force behind this development is the advent of powerful machine learning methods which enable researchers to derive novel scientific insights from large datasets. Another is the strong development of high performance computing (HPC) hardware and the accompanying development of software libraries and packages which can efficiently take advantage of the hardware.</p>
<p>This course focuses on high-performace data analytics (HPDA), a subset of high-performance computing which focuses on working with large data. The data can come from either computer models and simulations or from experiments and observations, and the goal is to preprocess, analyse and visualise it to generate scientific results.</p>
<p>The video shown below provide more descriptions of the big data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">IPython.display</span><span class="w"> </span><span class="kn">import</span> <span class="n">YouTubeVideo</span>

<span class="n">YouTubeVideo</span><span class="p">(</span><span class="s1">&#39;qydP7cOH4qc&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">360</span><span class="p">)</span>
</pre></div>
</div>
<iframe width="600" height="360" src="https://www.youtube.com/embed/qydP7cOH4qc" frameborder="0" allowfullscreen  ></iframe> 
</section>
<section id="python">
<h4>1.2 Python<a class="headerlink" href="#python" title="Link to this heading"></a></h4>
<div class="admonition-discussion discussion important admonition" id="discussion-0">
<p class="admonition-title">Discussion</p>
<p><strong>Performance bottlenecks in Python</strong></p>
<ul class="simple">
<li><p>Have you ever written Python scripts that look something like the one below?</p></li>
<li><p>Compared to C/C++/Fortran, this for-loop will probably be orders of magnitude slower</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">f</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;mydata.dat&quot;</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">f</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
    <span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">fields</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
    <span class="c1"># some analysis with x, y and z</span>
<span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<p>Despite early design choices of the Python language which made it significantly slower than conventional HPC languages, a rich and growing ecosystem of open source libraries have established Python as an industry-standard programming language for working with data on all levels of the data analytics pipeline. These range from generic numerical libraries to special-purpose and/or domain-specific packages. This lesson is focused on introducing modern packages from the Python ecosystem to work with large data. Specifically, we will learn to use:</p>
<ul class="simple">
<li><p>Numpy</p></li>
<li><p>Scipy</p></li>
<li><p>Pandas</p></li>
<li><p>Xarray</p></li>
<li><p>Numba</p></li>
<li><p>Cython</p></li>
<li><p>multithreading</p></li>
<li><p>multiprocessing</p></li>
<li><p>Dask</p></li>
</ul>
</section>
<section id="what-you-will-learn">
<h4>1.3 What You Will Learn<a class="headerlink" href="#what-you-will-learn" title="Link to this heading"></a></h4>
<p>This lesson provides a broad overview of methods to work with large datasets using tools and libraries from the Python ecosystem. Since this field is fairly extensive we will not have time to go into much depth. Instead, the objective is to expose just enough details on each topic for you to get a good idea of the big picture and an understanding of what combination of tools and libraries will work well for your particular use case.</p>
<p>Specifically, <strong>this course covers</strong>:</p>
<ul class="simple">
<li><p>Tools for efficiently storing data and writing/reading data to/from disk</p></li>
<li><p>How to share datasets and mint digital object identifiers (DOI)</p></li>
<li><p>Main methods of efficiently working with tabular data and multidimensional arrays</p></li>
<li><p>How to measure performance and boost performance of time consuming Python functions</p></li>
<li><p>Various methods to parallelise Python code</p></li>
</ul>
<p>The course does not cover the following episodes but the lesson materials for these episodes are provided at other modules. Please refer to the links provided below to the other course materials.</p>
<ul class="simple">
<li><p><a class="reference external" href="https://enccs.github.io/gpu-programming/">Visualisation techniques</a></p></li>
<li><p><a class="reference external" href="https://enccs.github.io/gpu-programming/">Machine learning</a></p></li>
<li><p><a class="reference external" href="https://enccs.github.io/gpu-programming/">GPU programming</a></p></li>
</ul>
</section>
<section id="keypoints">
<h4>1.4 Keypoints<a class="headerlink" href="#keypoints" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>Datasets are getting larger across nearly all scientific and engineering domains</p></li>
<li><p>The Python ecosystem has many libraries and packages for working with big data efficiently</p></li>
</ul>
</section>
</section>
<span id="document-Python-HPDA-2-EfficientArrayComputing"></span><section id="efficient-array-computing">
<h3>2. Efficient Array Computing<a class="headerlink" href="#efficient-array-computing" title="Link to this heading"></a></h3>
<p>This episode introduces how to write high-performance numerical code in Python packages (Numpy, Pandas, and Scipy) by leveraging tools and libraries designed to optimize computation speed and memory usage. It explores strategies such as vectorization with NumPy, just-in-time compilation using Numba, and parallelization techniques that can significantly reduce execution time. These methods help Python developers overcome the traditional performance limitations of the language, making it suitable for intensive scientific and engineering applications.</p>
<div class="admonition-objectives objectives admonition" id="objectives-0">
<p class="admonition-title">Objectives</p>
<ul class="simple">
<li><p>Understand limitations of Python’s standard library for large data processing</p></li>
<li><p>Understand limitations of Python’s standard library for large data processing</p></li>
<li><p>Understand the logic behind NumPy ndarrays and learn to use some NumPy numerical computing tools</p></li>
<li><p>Learn to use data structures and analysis tools from Panda</p></li>
</ul>
</div>
<div class="admonition-instructor-note instructor-note admonition" id="instructor-note-0">
<p class="admonition-title">Instructor note</p>
<ul class="simple">
<li><p>25 min teaching/type-along</p></li>
<li><p>25 min exercising</p></li>
</ul>
</div>
<section id="why-can-python-be-slow">
<h4>2.1 Why can Python be slow?<a class="headerlink" href="#why-can-python-be-slow" title="Link to this heading"></a></h4>
<p>Computer programs are nowadays practically always written in a high-level human readable programming language and then translated to the actual machine instructions that a processor understands. There are two main approaches for this translation:</p>
<ul class="simple">
<li><p>For <strong>compiled</strong> programming languages, the translation is done by a compiler before the execution of the program</p></li>
<li><p>For <strong>interpreted</strong> languages, the translation is done by an interpreter during the execution of the program</p></li>
</ul>
</section>
<section id="numpy">
<h4>2.2 NumPy<a class="headerlink" href="#numpy" title="Link to this heading"></a></h4>
<p>NumPy is based on well-optimized C code, which gives much better performace than regular Python. In particular, by using homogeneous data structures, NumPy <em>vectorizes</em> mathematical operations where fast pre-compiled code can be applied to a sequence of data instead of using traditional <code class="docutils literal notranslate"><span class="pre">for</span></code> loops.</p>
<section id="arrays">
<h5>2.2.1 Arrays<a class="headerlink" href="#arrays" title="Link to this heading"></a></h5>
<p>The core of NumPy is the NumPy <code class="docutils literal notranslate"><span class="pre">ndarray</span></code> (n-dimensional array). Compared to a Python list, an ndarray is similar in terms of serving as a data container. Some differences between the two are:</p>
<ul class="simple">
<li><p>ndarrays can have multiple dimensions, <em>e.g.</em> a 1-D array is a vector, a 2-D array is a matrix</p></li>
<li><p>ndarrays are fast only when all data elements are of the same type</p></li>
</ul>
<p><img alt="" src="_images/python-list-vs-numpy-array.svg" /></p>
</section>
<section id="creating-numpy-arrays">
<h5>2.2.2 Creating NumPy arrays<a class="headerlink" href="#creating-numpy-arrays" title="Link to this heading"></a></h5>
<p>One way to create a NumPy array is to convert from a Python list, but make sure that the list is homogeneous (contains same data type) otherwise performace will be downgraded. Since appending elements to an existing array is slow, it is a common practice to preallocate the necessary space with <code class="docutils literal notranslate"><span class="pre">np.zeros</span></code> or <code class="docutils literal notranslate"><span class="pre">np.empty</span></code> when converting from a Python list is not possible.</p>
<div class="{demo}: docutils">
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="nb">float</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;a = </span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># array([ 1., 2., 3., 4.])</span>

<span class="n">list1</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]]</span>
<span class="n">mat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">list1</span><span class="p">,</span> <span class="nb">complex</span><span class="p">)</span>
<span class="c1"># create complex array, with imaginary part equal to zero</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mat = </span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">mat</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># array([[ 1.+0.j, 2.+0.j, 3.+0.j],</span>
<span class="c1">#       [ 4.+0.j, 5.+0.j, 6.+0.j]])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mat.shape=</span><span class="si">{</span><span class="n">mat</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, mat.size=</span><span class="si">{</span><span class="n">mat</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="c1"># mat.shape=(2, 3), mat.size=6</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>You should copy the code above to a separate code block, or change its cell type from from <code class="docutils literal notranslate"><span class="pre">Markdown</span></code> to <code class="docutils literal notranslate"><span class="pre">Code</span></code>.</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">arange</span></code> and <code class="docutils literal notranslate"><span class="pre">linspace</span></code> can generate ranges of numbers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="c1"># array([0, 1, 2, 3, 4, 5, 6, 7, 8, 9])</span>

<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># array([0.1 , 0.12, 0.14, 0.16, 0.18])</span>

<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">4.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
<span class="c1"># array([-4.5 , -2.25, 0. , 2.25, 4.5 ])</span>
</pre></div>
</div>
</section>
<section id="array-operations-and-manipulations">
<h5>2.2.3 Array operations and manipulations<a class="headerlink" href="#array-operations-and-manipulations" title="Link to this heading"></a></h5>
<p>All the familiar arithmetic operators in NumPy are applied elementwise:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1D example</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">])</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot; a+b = </span><span class="si">{</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="si">}</span><span class="se">\n</span><span class="s2"> a/b = </span><span class="si">{</span><span class="n">a</span><span class="o">/</span><span class="n">b</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/np_add_1d_new.svg" /></p>
<p><img alt="" src="_images/np_div_1d_new.svg" /></p>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<p>Run the code below to get familiar with indexing in a 2D example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2D example</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">]])</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="o">+</span><span class="n">b</span><span class="p">)</span>
<span class="c1"># [[11, 12, 13],</span>
<span class="c1">#  [14, 15, 16]]</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>You can download the code example from <a class="reference download internal" download="" href="_downloads/46e37b8ffc5d069fc1050c329cdf9200/code-example.py"><span class="xref download myst">HERE</span></a>.</p>
</div>
<p><img alt="" src="_images/np_add_2d.svg" /></p>
</section>
<section id="array-indexing">
<h5>2.2.4 Array indexing<a class="headerlink" href="#array-indexing" title="Link to this heading"></a></h5>
<p>Basic indexing is similar to Python lists. Note that advanced indexing creates copies of arrays.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1D example</span>

<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">])</span>

<span class="c1"># integer indexing</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integer indexing&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data = </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[3] = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[0:2] = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[-2] = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[::-4] = </span><span class="si">{</span><span class="n">data</span><span class="p">[::</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># fancy indexing</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Fancy indexing&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[[1,6,3]] = </span><span class="si">{</span><span class="n">data</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">,</span><span class="mi">3</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># boolean indexing</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Boolean indexing&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[data&gt;5] = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">5</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="_images/array-indexing-1D.png" /></p>
<div class="admonition-exercise exercise important admonition" id="exercise-1">
<p class="admonition-title">Exercise</p>
<p>Run the code below to get familiar with indexing in a 2D example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2D example</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">],[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">],[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]])</span>

<span class="c1"># integer indexing</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Integer indexing&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[1] = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[:, 1] = </span><span class="si">{</span><span class="n">data</span><span class="p">[:,</span><span class="w"> </span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[1:3, 2:4] = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># fancy indexing</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Fancy indexing&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[[0,2,1], [2,3,0]] = </span><span class="si">{</span><span class="n">data</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span><span class="w"> </span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># boolean indexing</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Boolean indexing&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;data[data&gt;10] = </span><span class="si">{</span><span class="n">data</span><span class="p">[</span><span class="n">data</span><span class="o">&gt;</span><span class="mi">10</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Again, you should move the code above to a separate code block, or change its cell type from from <code class="docutils literal notranslate"><span class="pre">Markdown</span></code> to <code class="docutils literal notranslate"><span class="pre">Code</span></code>.</p>
</div>
</section>
<section id="i-o-with-numpy">
<h5>2.2.5 I/O with NumPy<a class="headerlink" href="#i-o-with-numpy" title="Link to this heading"></a></h5>
<p>Numpy provides functions for reading from/writing to files. Both ASCII and binary formats are supported with the CSV and npy/npz formats.</p>
<p><strong>CSV</strong></p>
<p>The <code class="docutils literal notranslate"><span class="pre">numpy.loadtxt()</span></code> and <code class="docutils literal notranslate"><span class="pre">numpy.savetxt()</span></code> functions can be used. They save in a regular column layout and can deal with different delimiters, column titles and numerical representations.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s2">&quot;my_array.csv&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s2">&quot;my_array.csv&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># [ True  True  True  True]</span>
</pre></div>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>If you get an eror like xxx, you should import numpy before the first line <code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">numpy</span> <span class="pre">as</span> <span class="pre">np</span></code>.</p>
</div>
<p><strong>Binary</strong></p>
<p>The npy format is a binary format used to dump arrays of any shape. Several arrays can be saved into a single npz file, which is simply a zipped collection of different npy files. All the arrays to be saved into a npz file can be passed as kwargs to the <code class="docutils literal notranslate"><span class="pre">numpy.savez()</span></code> function. The data can then be recovered using the <code class="docutils literal notranslate"><span class="pre">numpy.load()</span></code> method, which returns a dictionary-like object in which each key points to one of the arrays.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">])</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>

<span class="n">np</span><span class="o">.</span><span class="n">savez</span><span class="p">(</span><span class="s2">&quot;my_arrays.npz&quot;</span><span class="p">,</span> <span class="n">array_1</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">array_2</span><span class="o">=</span><span class="n">b</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;my_arrays.npz&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;array_1&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">)</span> <span class="c1"># [ True  True  True  True]</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s1">&#39;array_2&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">)</span> <span class="c1"># [ True  True  True  True]</span>
</pre></div>
</div>
</section>
<section id="random-numbers">
<h5>2.2.6 Random numbers<a class="headerlink" href="#random-numbers" title="Link to this heading"></a></h5>
<p>The module <code class="docutils literal notranslate"><span class="pre">numpy.random</span></code> provides several functions for constructing random arrays</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">random()</span></code>: uniform random numbers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">normal()</span></code>: normal distribution</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">choice()</span></code>: random sample from given array</p></li>
<li><p>…</p></li>
</ul>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">)),</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="mi">10</span><span class="p">))</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>You might get different results from this code example.</p>
</div>
</section>
</section>
<section id="pandas">
<h4>2.3 Pandas<a class="headerlink" href="#pandas" title="Link to this heading"></a></h4>
<p>Pandas is a Python package that provides high-performance and easy to use data structures and data analysis tools. The core data structures of Pandas are Series and Dataframes.</p>
<ul class="simple">
<li><p>a Pandas <code class="docutils literal notranslate"><span class="pre">series</span></code> is a one-dimensional NumPy array with an index which we could use to access the data</p></li>
<li><p>a <code class="docutils literal notranslate"><span class="pre">dataframe</span></code> consist of a table of values with labels for each row and column. A dataframe can combine multiple data types, such as numbers and text, but the data in each column is of the same type.</p></li>
<li><p>each column of a dataframe is a series object - a dataframe is thus a colle tion of series.</p></li>
</ul>
<p><img alt="" src="_images/pandas_dataframe.svg" /></p>
<section id="data-analysis-workflow">
<h5>2.3.1 Data analysis workflow<a class="headerlink" href="#data-analysis-workflow" title="Link to this heading"></a></h5>
<p>Pandas is a powerful tool for many steps of a data analysis pipeline:</p>
<p>To explore some of the capabilities, we start with an example dataset containing the passenger list from the Titanic, which is often used in Kaggle competitions and data science tutorials. First step is to load Pandas and download the dataset into a dataframe.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>

<span class="n">url</span> <span class="o">=</span> <span class="s2">&quot;https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv&quot;</span>

<span class="c1"># set the index to the &quot;Name&quot; column</span>
<span class="n">titanic</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s2">&quot;Name&quot;</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Pandas also understands multiple other formats, for example <code class="docutils literal notranslate"><span class="pre">read_excel()</span></code>, <code class="docutils literal notranslate"><span class="pre">read_hdf()</span></code>, <code class="docutils literal notranslate"><span class="pre">read_json()</span></code>, <em>etc.</em> (and corresponding methods to write to file: <code class="docutils literal notranslate"><span class="pre">to_csv()</span></code>, <code class="docutils literal notranslate"><span class="pre">to_excel()</span></code>, <code class="docutils literal notranslate"><span class="pre">to_hdf()</span></code>, <code class="docutils literal notranslate"><span class="pre">to_json()</span></code>, …)…)</p>
</div>
<p>We can now view the dataframe to get an idea of what it contains and print some summary statistics of its numerical data:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># print the first 5 lines of the dataframe</span>
<span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>

<span class="c1"># print some information about the columns</span>
<span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>

<span class="c1"># print summary statistics for each column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>
</pre></div>
</div>
</section>
<section id="missing-invalid-data">
<h5>2.3.2 Missing/invalid data<a class="headerlink" href="#missing-invalid-data" title="Link to this heading"></a></h5>
<p>What if your dataset has missing data? Pandas uses the value np.nan to represent missing data, and by default does not include it in any computations. We can find missing values, drop them from our dataframe, replace them with any value we like or do forward or backward filling.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">titanic</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span>                           <span class="c1"># returns boolean mask of NaN values</span>

<span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">())</span>                  <span class="c1"># drop missing values</span>
<span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">))</span>         <span class="c1"># or how=&quot;all&quot;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cabin&quot;</span><span class="p">]))</span>  <span class="c1"># only drop NaNs from one column</span>
<span class="nb">print</span><span class="p">(</span><span class="n">titanic</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>                 <span class="c1"># replace NaNs with zero</span>
</pre></div>
</div>
</section>
</section>
<section id="scipy">
<h4>2.4 Scipy<a class="headerlink" href="#scipy" title="Link to this heading"></a></h4>
<p>Let us look more closely into one out of the countless useful functions available in SciPy. <code class="docutils literal notranslate"><span class="pre">curve_fit()</span></code> is a non-linear least squares fitting function. NumPy has least-squares fitting via the <code class="docutils literal notranslate"><span class="pre">np.linalg.lstsq()</span></code> function, but we need to go to SciPy to find non-linear curve fitting. This example fits a power-law to a vector.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">powerlaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="c1"># data</span>
<span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">9115</span><span class="p">,</span> <span class="mi">8368</span><span class="p">,</span> <span class="mi">7711</span><span class="p">,</span> <span class="mi">5480</span><span class="p">,</span> <span class="mi">3492</span><span class="p">,</span> <span class="mi">3376</span><span class="p">,</span> <span class="mi">2884</span><span class="p">,</span> <span class="mi">2792</span><span class="p">,</span> <span class="mi">2703</span><span class="p">,</span> <span class="mi">2701</span><span class="p">])</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0</span>

<span class="c1"># initial guess for variables</span>
<span class="n">p0</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="c1"># fit data</span>
<span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">,</span> <span class="n">xdata</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="n">Y</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="n">p0</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;A =&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;+/-&quot;</span><span class="p">,</span> <span class="n">cov</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;s =&quot;</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;+/-&quot;</span><span class="p">,</span> <span class="n">cov</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># optionally plot</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">matplotlib.pyplot</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">plt</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">powerlaw</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="exercises">
<h4>2.5 Exercises<a class="headerlink" href="#exercises" title="Link to this heading"></a></h4>
<div class="dropdown exercise important admonition" id="exercise-2">
<p class="admonition-title">Working effectively with dataframes</p>
<p>Recall the <code class="docutils literal notranslate"><span class="pre">curve_fit()</span></code> method from SciPy discussed above, and imagine that we want to fit powerlaws to every row in a large dataframe. How can this be done effectively?</p>
<p>First define the <code class="docutils literal notranslate"><span class="pre">powerlaw()</span></code> function and another function for fitting a row of numbers:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">scipy.optimize</span><span class="w"> </span><span class="kn">import</span> <span class="n">curve_fit</span>

<span class="k">def</span><span class="w"> </span><span class="nf">powerlaw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">A</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">row</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="mf">1.0</span>
    <span class="n">params</span><span class="p">,</span> <span class="n">cov</span> <span class="o">=</span> <span class="n">curve_fit</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">powerlaw</span><span class="p">,</span> <span class="n">xdata</span><span class="o">=</span><span class="n">X</span><span class="p">,</span> <span class="n">ydata</span><span class="o">=</span><span class="n">row</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">bounds</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">params</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
<p>Next load a dataset with multiple rows similar to the one used in the example above:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;https://raw.githubusercontent.com/ENCCS/hpda-python/main/content/data/results.csv&quot;</span><span class="p">)</span>
<span class="c1"># print first few rows</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
<p>Now consider these four different ways of fitting a powerlaw to each row of the dataframe:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1. Loop</span>

<span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_indx</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
    <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2. `iterrows()</span>

<span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
    <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3. `apply()</span>

<span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. `apply()` with `raw=True`</span>

<span class="c1"># raw=True passes numpy ndarrays instead of series to fit_powerlaw</span>
<span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Which one do you think is most efficient? You can measure the execution time by adding <code class="docutils literal notranslate"><span class="pre">%%timeit</span></code> to the first line of a Jupyter code cell. More on timing and profiling in a later episode.</p>
</div>
<div class="dropdown solution important admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p>The execution time for four different methods are described below. Note that you may get different numbers when you run these examples.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 1 Loop</span>

<span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
   <span class="n">row</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">row_indx</span><span class="p">,</span><span class="mi">1</span><span class="p">:]</span>
   <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
   <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># 33.6 ms ± 682 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 2. `iterrows()`</span>

<span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">row_indx</span><span class="p">,</span><span class="n">row</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
   <span class="n">p</span> <span class="o">=</span> <span class="n">fit_powerlaw</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
   <span class="n">powers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

<span class="c1"># 28.7 ms ± 947 µs per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 3. `apply()`</span>

<span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># 26.1 ms ± 1.19 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># 4. `apply()` with `raw=True`</span>

<span class="o">%%</span><span class="n">timeit</span>
<span class="n">powers</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">fit_powerlaw</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># 24 ms ± 1.27 ms per loop (mean ± std. dev. of 7 runs, 10 loops each)</span>
</pre></div>
</div>
</div>
<div class="dropdown exercise important admonition" id="exercise-3">
<p class="admonition-title">Further analysis of Titanic passenger list dataset</p>
<p>Consider the titanic dataset.</p>
<blockquote>
<div><p>If you haven’t done so already, load it into a dataframe before the exercises:
<code class="docutils literal notranslate"><span class="pre">import</span> <span class="pre">pandas</span> <span class="pre">as</span> <span class="pre">pd;</span> <span class="pre">url</span> <span class="pre">=</span> <span class="pre">&quot;https://raw.githubusercontent.com/pandas-dev/pandas/master/doc/data/titanic.csv&quot;;</span> <span class="pre">titanic</span> <span class="pre">=</span> <span class="pre">pd.read_csv(url,</span> <span class="pre">index_col=&quot;Name&quot;)</span></code></p>
</div></blockquote>
<ul class="simple">
<li><p>Compute the mean age of the first 10 passengers by slicing and the <code class="docutils literal notranslate"><span class="pre">mean</span></code> method</p></li>
<li><p>Using boolean indexing, compute the survival rate (mean of “Survived” values) among passengers over and under the average age.
Now investigate the family size of the passengers (<em>i.e.</em> the “SibSp” column):</p></li>
<li><p>What different family sizes exist in the passenger list?</p>
<ul>
<li><p>Hint: try the <code class="docutils literal notranslate"><span class="pre">unique()</span></code> method</p></li>
</ul>
</li>
<li><p>What are the names of the people in the largest family group?</p></li>
<li><p>(Advanced) Create histograms showing the distribution of family sizes for passengers split by the fare, i.e. one group of high-fare passengers (where the fare is above average) and one for low-fare passengers</p>
<ul>
<li><p><font color='green'><strong>Hint</strong></font>: instead of an existing column name, you can give a lambda function as a parameter to <code class="docutils literal notranslate"><span class="pre">hist</span></code> to compute a value on the fly. For example <code class="docutils literal notranslate"><span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">&quot;Poor&quot;</span> <span class="pre">if</span> <span class="pre">titanic[&quot;Fare&quot;].loc[x]</span> <span class="pre">&lt;</span> <span class="pre">titanic[&quot;Fare&quot;].mean()</span> <span class="pre">else</span> <span class="pre">&quot;Rich&quot;</span></code>).</p></li>
</ul>
</li>
</ul>
</div>
<div class="dropdown solution important admonition" id="solution-1">
<p class="admonition-title">Solution</p>
<ol class="arabic simple">
<li><p>Mean age of the first 10 passengers:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">titanic.iloc[:10,:][&quot;Age&quot;].mean()</span></code> or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titanic.iloc[:10,4].mean()</span></code> or</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titanic.loc[:&quot;Nasser,</span> <span class="pre">Mrs.</span> <span class="pre">Nicholas</span> <span class="pre">(Adele</span> <span class="pre">Achem)&quot;,</span> <span class="pre">&quot;Age&quot;].mean()</span></code></p></li>
</ul>
</li>
<li><p>Survival rate among passengers over and under average age:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">titanic[titanic[&quot;Age&quot;]</span> <span class="pre">&gt;</span> <span class="pre">titanic[&quot;Age&quot;].mean()][&quot;Survived&quot;].mean()</span></code> and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titanic[titanic[&quot;Age&quot;]</span> <span class="pre">&lt;</span> <span class="pre">titanic[&quot;Age&quot;].mean()][&quot;Survived&quot;].mean()</span></code></p></li>
</ul>
</li>
<li><p>Existing family sizes: <code class="docutils literal notranslate"><span class="pre">titanic[&quot;SibSp&quot;].unique()</span></code></p></li>
<li><p>Names of members of largest family(ies): <code class="docutils literal notranslate"><span class="pre">titanic[titanic[&quot;SibSp&quot;]</span> <span class="pre">==</span> <span class="pre">8].index</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">titanic.hist(&quot;SibSp&quot;,</span> <span class="pre">lambda</span> <span class="pre">x:</span> <span class="pre">&quot;Poor&quot;</span> <span class="pre">if</span> <span class="pre">titanic[&quot;Fare&quot;].loc[x]</span> <span class="pre">&lt;</span> <span class="pre">titanic[&quot;Fare&quot;].mean()</span> <span class="pre">else</span> <span class="pre">&quot;Rich&quot;,</span> <span class="pre">rwidth=0.9)</span></code></p></li>
</ol>
</div>
</section>
<section id="keypoints">
<h4>2.6 Keypoints<a class="headerlink" href="#keypoints" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p>NumPy provides a static array data structure, fast mathematical operations for arrays and tools for linear algebra and random numbers</p></li>
<li><p>Pandas dataframes are a good data structure for tabular data</p></li>
<li><p>Dataframes allow both simple and advanced analysis in very compact form</p></li>
</ul>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<ul class="simple">
<li><p><a class="reference external" href="https://uppmax.github.io/R-python-julia-matlab-HPC/">Introduction to running R, Python, Julia, and Matlab in HPC</a></p></li>
<li><p><a class="reference external" href="https://github.com/ENCCS/webinar_documents/tree/main/2024-oct-24-python">Practical Intro to GPU Programming using Python</a></p></li>
<li><p><a class="reference external" href="https://uppmax.github.io/HPC-python/">Using Python in an HPC environment</a></p></li>
<li><p><a class="reference external" href="https://aaltoscicomp.github.io/python-for-scicomp/">Python for Scientific Computing</a></p></li>
<li><p>…</p></li>
</ul>
</div>
<div class="dropdown exercise important admonition" id="exercise-4">
<p class="admonition-title">Homework</p>
<p><strong>Choice questions</strong></p>
<p>Why are Python lists inefficient for numerical computations?</p>
<ul class="simple">
<li><p><strong>A) They store elements as generic objects with dynamic typing</strong></p></li>
<li><p>B) They are statically typed</p></li>
<li><p>C) They don’t support indexing</p></li>
<li><p>D) They don’t support loops</p></li>
</ul>
<p>What is the main advantage of NumPy arrays (ndarray) over Python lists for numerical tasks?</p>
<ul class="simple">
<li><p>A) They can hold multiple data types</p></li>
<li><p>B) They automatically parallelize loops</p></li>
<li><p><strong>C) They store data in a compact, contiguous block of memory</strong></p></li>
<li><p>D) They have larger memory overhead</p></li>
</ul>
<p>What is “vectorization” in the context of NumPy?</p>
<ul class="simple">
<li><p>A) A way to convert lists to dictionaries</p></li>
<li><p>B) A process of compiling Python code</p></li>
<li><p>C) A plotting technique</p></li>
<li><p><strong>D) Replacing explicit loops with whole-array operations</strong></p></li>
</ul>
<p>How does a pandas DataFrame differ from a NumPy array?</p>
<ul class="simple">
<li><p>A) DataFrames are slower and less powerful</p></li>
<li><p><strong>B) DataFrames support heterogeneous data types and labeled axes</strong></p></li>
<li><p>C) Arrays use less memory</p></li>
<li><p>D) DataFrames cannot be indexed</p></li>
</ul>
<p>What does <code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit()</span></code> do?</p>
<ul class="simple">
<li><p>A) Performs numerical integration</p></li>
<li><p><strong>B) Fits data to a model function</strong></p></li>
<li><p>C) Solves a linear system</p></li>
<li><p>D) Computes a histogram</p></li>
</ul>
<p><strong>Coding questions</strong></p>
<p>Generate a 1D NumPy array of 1 million random floats. Compute the square root of each element using:</p>
<ul class="simple">
<li><p>a) a Python for loop</p></li>
<li><p>b) NumPy’s vectorized np.sqrt</p></li>
</ul>
<p>Load a CSV file of weather data (<em>e.g.</em>, temperature, humidity, wind).</p>
<ul class="simple">
<li><p>a) filter rows where temperature &gt; 30°C</p></li>
<li><p>b) compute the average humidity for each month using <code class="docutils literal notranslate"><span class="pre">groupby</span></code></p></li>
</ul>
<p>Create a random 100×100 matrix A and a vector b.</p>
<ul class="simple">
<li><p>a) use <code class="docutils literal notranslate"><span class="pre">scipy.linalg.solve</span></code> to solve the system $Ax = b$</p></li>
<li><p>b) verify the solution by checking the residual norm</p></li>
</ul>
<p>Simulate a DataFrame with missing values in numerical columns.</p>
<ul class="simple">
<li><p>a) fill missing values with the column mean (using NumPy)</p></li>
<li><p>b) compute basic statistics before and after imputation</p></li>
</ul>
<p>Generate noisy data for a quadratic function $y = ax² + bx + c$</p>
<ul class="simple">
<li><p>a) use <code class="docutils literal notranslate"><span class="pre">scipy.optimize.curve_fit</span></code> to fit the data and recover the original parameters</p></li>
<li><p>b) plot the original <em>vs</em> fitted curve</p></li>
</ul>
</div>
</section>
</section>
<span id="document-3-jupyter-notebook-styling"></span><section id="sphinx-directives">
<h3>3. Sphinx Directives<a class="headerlink" href="#sphinx-directives" title="Link to this heading"></a></h3>
<section id="directives">
<h4>Directives<a class="headerlink" href="#directives" title="Link to this heading"></a></h4>
<p>There are directives in Sphinx to highlight code blocks</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">discussion</span></code>, <code class="docutils literal notranslate"><span class="pre">demo</span></code>, <code class="docutils literal notranslate"><span class="pre">exercises</span></code>, <code class="docutils literal notranslate"><span class="pre">solution</span></code>, <code class="docutils literal notranslate"><span class="pre">homework</span></code>, <code class="docutils literal notranslate"><span class="pre">seealso</span></code>…</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">note</span></code>, <code class="docutils literal notranslate"><span class="pre">hint</span></code>, <code class="docutils literal notranslate"><span class="pre">important</span></code>, <code class="docutils literal notranslate"><span class="pre">attention</span></code>, <code class="docutils literal notranslate"><span class="pre">caution</span></code>,<code class="docutils literal notranslate"><span class="pre">warning</span></code>, <code class="docutils literal notranslate"><span class="pre">danger</span></code>, …</p></li>
</ul>
<p>In Jupyter NB, there is no such stryling settings. We can ask course developers to provide some keywords (as listed below) before the code block. and we can convert these Jupyter NB blocks to Sphinx blocks.</p>
<p>The format in the Jupyter NB should look like the content below:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;font color=&#39;purple&#39;&gt;**Discussion**&lt;/font&gt;: How large is your data?

- How large is the data you are working with?
- Are you experiencing performance bottlenecks when you try to analyse it?
&lt;/div&gt;
</pre></div>
</div>
<ul class="simple">
<li><p>Highlight the keyword (here it is <code class="docutils literal notranslate"><span class="pre">Discussion</span></code>) using the corresponding font color</p></li>
<li><p>the Jupyter NB code block starts with <code class="docutils literal notranslate"><span class="pre">&lt;font</span> <span class="pre">color=</span></code> and ends with <code class="docutils literal notranslate"><span class="pre">&lt;/div&gt;</span></code></p></li>
</ul>
<div class="admonition-how-large-is-your-data discussion important admonition" id="discussion-0">
<p class="admonition-title">How large is your data?</p>
<ul class="simple">
<li><p>How large is the data you are working with?</p></li>
<li><p>Are you experiencing performance bottlenecks when you try to analyse it?</p></li>
</ul>
</div>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Do not remove the following line.</p>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Do not remove the following line.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Do not remove the following line.</p>
</div>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>Here is a danger!</p>
</div>
<div class="admonition error">
<p class="admonition-title">Error</p>
<p>Here is an error!</p>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>In this exercise, you can use A instead of B.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>In this exercise, you can use A instead of B.</p>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>You should use the latest version of Python.</p>
</div>
<div class="admonition-exercise exercise important admonition" id="exercise-0">
<p class="admonition-title">Exercise</p>
<p>Description of exercise</p>
<ul class="simple">
<li><p>Do this</p></li>
<li><p>then do this</p></li>
<li><p>finally observe what happens when you do this…do this…</p></li>
</ul>
</div>
<div class="dropdown exercise important admonition" id="exercise-1">
<p class="admonition-title">With an option “Click to show”</p>
<p>Description of exercise</p>
<ul class="simple">
<li><p>Do this</p></li>
<li><p>then do this</p></li>
<li><p>finally observe what happens when you do this…do this…</p></li>
</ul>
</div>
<div class="admonition-solution solution important dropdown admonition" id="solution-0">
<p class="admonition-title">Solution</p>
<p>Here is the solution for above exercises.</p>
</div>
<div class="admonition-homework homework important admonition" id="homework-0">
<p class="admonition-title">Homework</p>
<p>Here are the homework assignments for this episode.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here we chose to summarize the data by its mean, but many other common statistical functions are available as dataframe methods, like <code class="docutils literal notranslate"><span class="pre">std()</span></code>, <code class="docutils literal notranslate"><span class="pre">min()</span></code>, <code class="docutils literal notranslate"><span class="pre">max()</span></code>, <code class="docutils literal notranslate"><span class="pre">cumsum()</span></code>, <code class="docutils literal notranslate"><span class="pre">median()</span></code>, <code class="docutils literal notranslate"><span class="pre">skew()</span></code>, <code class="docutils literal notranslate"><span class="pre">var()</span></code>, <em>etc.</em></p>
</div>
<div class="admonition-demo demo admonition" id="demo-0">
<p class="admonition-title">Demo</p>
<p>Code for demonstration</p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>publications and webpages for references</p>
</div>
</section>
<section id="define-addition-keywords">
<h4>Define addition keywords<a class="headerlink" href="#define-addition-keywords" title="Link to this heading"></a></h4>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">suggestion</span></code>, <code class="docutils literal notranslate"><span class="pre">recommendation</span></code>, …</p></li>
</ul>
<div class="admonition-suggestion callout admonition" id="callout-0">
<p class="admonition-title">Suggestion</p>
<p>It is recommended to use the CUDA version &gt; 10.0.</p>
</div>
</section>
<section id="badges">
<h4>Badges<a class="headerlink" href="#badges" title="Link to this heading"></a></h4>
<p>Here is one badge after we publish this module at Zenodo.</p>
<a class="reference external image-reference" href="https://doi.org/10.5281/zenodo.14844443"><img alt="https://zenodo.org/badge/DOI/10.5281/zenodo.14844443.svg" src="https://zenodo.org/badge/DOI/10.5281/zenodo.14844443.svg" />
</a>
<p>We can design other badges with different colors.</p>
<img alt="https://img.shields.io/badge/AAAA-blue?style=plastic" src="https://img.shields.io/badge/AAAA-blue?style=plastic" />
<img alt="https://img.shields.io/badge/BBBB-purple?style=plastic" src="https://img.shields.io/badge/BBBB-purple?style=plastic" />
<img alt="https://img.shields.io/badge/CCCC-red?style=plastic" src="https://img.shields.io/badge/CCCC-red?style=plastic" />
<img alt="https://img.shields.io/badge/DDDD-996300?style=plastic" src="https://img.shields.io/badge/DDDD-996300?style=plastic" />
<img alt="https://img.shields.io/badge/EEEE-gold?style=plastic" src="https://img.shields.io/badge/EEEE-gold?style=plastic" />
<img alt="https://img.shields.io/badge/FFFF-orange?style=plastic" src="https://img.shields.io/badge/FFFF-orange?style=plastic" />
<img alt="https://img.shields.io/badge/Introductory-green?style=plastic" src="https://img.shields.io/badge/Introductory-green?style=plastic" />
<img alt="https://img.shields.io/badge/Intermediate-blueyellow?style=plastic" src="https://img.shields.io/badge/Intermediate-blueyellow?style=plastic" />
<iframe width="560" height="315" src="https://www.youtube.com/embed/YB-LCJBRvFs?start=4180" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
</section>
</section>
</div>
</section>
<section id="learning-outcomes">
<h2>Learning outcomes<a class="headerlink" href="#learning-outcomes" title="Link to this heading"></a></h2>
<p>This material is for all researchers and engineers who work with large or small datasets and who want to learn powerful tools and best practices for writing more performant, parallelised, robust and reproducible data analysis pipelines.</p>
<p>By the end of a workshop covering this lesson, learners should:</p>
<ul class="simple">
<li><p>Have a good overview of available tools and libraries for improving performance in Python (<strong>link to leaves in skill tre</strong>)</p></li>
<li><p>Knowing libraries for efficiently storing, reading and writing large data  (<strong>link to leaves in skill tree</strong>)</p></li>
<li><p>Be comfortable working with NumPy arrays and Pandas dataframes for data analysis using Python (<strong>link to leaves in skill tree</strong>)</p></li>
<li><p>…</p></li>
</ul>
</section>
<section id="instructors-guide">
<h2>Instructor’s guide<a class="headerlink" href="#instructors-guide" title="Link to this heading"></a></h2>
<section id="teaching-hours-and-number-of-participants">
<h3>Teaching hours and number of participants<a class="headerlink" href="#teaching-hours-and-number-of-participants" title="Link to this heading"></a></h3>
<p>This module is developed for one instructor and two teaching assistants during teaching for 40 students. The teaching can be delivered online, onsite, or in a hybrid format, providing flexibility to accommodate different learning preferences and circumstances. Whether students attend in person or remotely, the course materials and exercises are designed to ensure a consistent and engaging learning experience. Instructors can leverage virtual tools such as video conferencing and shared coding environments alongside traditional classroom setups to support all modes of delivery effectively.</p>
<p>Students are expected to dedicate 2-4 hours in total. This estimate combines contact hours, such as lectures or exercises (1~2 hours), with independent learning time (1-2 hours), which include self-study, assignments, and revision. Balancing these components ensures students have sufficient guided instruction while allowing ample time for personal engagement with the material.</p>
</section>
<section id="mode-of-teaching-and-exercising">
<h3>Mode of teaching and exercising<a class="headerlink" href="#mode-of-teaching-and-exercising" title="Link to this heading"></a></h3>
<p>Before teaching this module, the instructor is expected to set up the programming environment on the HPC cluster or assist students with installing the necessary packages on their personal computers. During exercises, instructors may use Jupyter notebooks for demonstrations or copy and paste code examples from the webpage into script files. These scripts can then be executed on students’ personal computers or the HPC cluster, providing a flexible learning experience.</p>
</section>
<section id="hardware-requirements-on-hpc-clusters">
<h3>Hardware requirements on HPC clusters<a class="headerlink" href="#hardware-requirements-on-hpc-clusters" title="Link to this heading"></a></h3>
<p>The HPC cluster used for this course should be equipped with modern NVIDIA GPUs that support CUDA programming. It is recommended that the cluster allocates a minimum of 20 GPU hours per person throughout the course duration. This allocation ensures sufficient time for code development, testing, and running computationally intensive workloads. A minimum of 16 GB GPU memory is recommended to handle large datasets and complex computations efficiently.</p>
<div class="warning admonition">
<p class="admonition-title">Credit</p>
<p>Don’t forget to check out additional <a class="reference external" href="https://www.evitahpc.eu/"><strong>course materials</strong></a> from XXX. Please <a class="reference external" href="https://www.evitahpc.eu/"><strong>contact us</strong></a> if you want to reuse these course materials in your teaching. You can also join the <a class="reference external" href="https://www.evitahpc.eu/"><strong>XXX channel</strong></a> to share your experience and get more help from the community.</p>
</div>
<div class="danger admonition">
<p class="admonition-title">Licensing</p>
<p>Copyright © 2025 XXX. This material is released by XXX under the Creative Commons Attribution 4.0 International (CC BY 4.0). These materials may include references to hardware and software developed by other entities; all applicable licensing and copyrights apply.</p>
</div>
</section>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, The contributors.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>